<!DOCTYPE html>
<html lang="en">
<%- include('./layout/head.ejs')  %>
<body>
    
    <%- include('./layout/nav.ejs')  %>

    <div class="content">
        <div>
            <h2>Latest Blog Posts</h2>
            <p class="text-muted">Total posts: <%= total %></p>
        </div>

        <!-- search -->
        <form class="mb-3" action="" method="GET">
            <div class="input-group">
                <input type="text" name="q" class="form-control" placeholder="Search posts...." value="<%= q || '' %>"/>
                <button type="submit" class="btn btn-outline-primary">Search</button>
                <% if(q){ %>
                    <a href="/" class="btn btn-online-secondary">Clear</a>
                <% } %>
            </div>
        </form>

        <% if(posts.length > 0){ %>
            <% posts.forEach(post=>{ %>


                <h3>
                    <a href="/posts/<%= post._id %>" style="text-decoration: none;"><%= post.title %></a>
                </h3>

                <small>Posted: <%= post.createdAt ? new Date(post.createdAt).toLocaleString() : "Unknown date" %></small>
                
                <h5><%= post.subtitle %></h5> 

                <p><%= post.body %></p>
                
                    <a href="/posts/<%= post._id %>/edit" class="btn">Edit</a>
                    <form action="/posts/<%= post._id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure to delete this post?')">
                        <button type="submit" class="btn">Delete</button>
                    </form>

                <hr/>
            <% }) %>

        <% }else{ %>
            <p>Thre are no blog posts to display.</p>
            <a href="/posts/create">Create First Post</a>
        <% } %>
     
        <!-- Pagination -->
        <!-- http://localhost:3000/?page=2 -->
        <div class="d-flex justify-content-center align-items-center gap-2 mt-4">
            <a href="/?page=<%= page - 1 %>" class="btn btn-outline-secondary">Prev</a>
            <span class="text-muted"><%= page %> / totalPage</span>
            <a href="/?page=<%= page + 1 %>" class="btn btn-outline-secondary">Next</a>
        </div>

    </div>

    <%- include('./layout/footer.ejs')  %>
</body>
</html>